<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Webhookクレジットカード登録状況 | billing-robo-apispec</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Webhookクレジットカード登録状況" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="請求管理ロボのAPI仕様書" />
<meta property="og:description" content="請求管理ロボのAPI仕様書" />
<link rel="canonical" href="http://0.0.0.0:4000/webhook/webhook_credit_status.html" />
<meta property="og:url" content="http://0.0.0.0:4000/webhook/webhook_credit_status.html" />
<meta property="og:site_name" content="billing-robo-apispec" />
<script type="application/ld+json">
{"headline":"Webhookクレジットカード登録状況","url":"http://0.0.0.0:4000/webhook/webhook_credit_status.html","description":"請求管理ロボのAPI仕様書","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="/assets/css/style.css?v=a2c448b5d116447955cb01efe3799a738dc0e23f">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">billing-robo-apispec</h1>
      <h2 class="project-tagline">請求管理ロボのAPI仕様書</h2>
      
        <a href="https://github.com/ROBOTPAYMENT/billing-robo-apispec" class="btn">View on GitHub</a>
      
      
    </section>

    <section class="main-content">
      <h1 id="webhookクレジットカード登録状況">Webhookクレジットカード登録状況</h1>

<p><code class="language-plaintext highlighter-rouge">Webhook URLはWebhook管理画面から設定が可能です。</code></p>

<p>クレジットカードの登録状況が変更された際に、そのステータスをWebhookとして通知します。</p>

<h2 id="アウトライン">アウトライン</h2>

<ul>
  <li><a href="#リクエスト">リクエスト</a>
    <ul>
      <li><a href="#共通リクエストパラメータ">共通リクエストパラメータ</a>
        <ul>
          <li><a href="#event_detail-request">event_detail (request)</a></li>
        </ul>
      </li>
      <li><a href="#サンプル">サンプル</a></li>
    </ul>
  </li>
  <li><a href="#webhookされるイベント一覧">webhookされるイベント一覧</a>
    <ul>
      <li><a href="#請求管理ロボ画面">請求管理ロボ画面</a></li>
      <li><a href="#請求管理ロボAPI">請求管理ロボAPI</a></li>
    </ul>
  </li>
</ul>

<h2 id="リクエスト">リクエスト</h2>
<ul>
  <li>HTTP method: <code class="language-plaintext highlighter-rouge">POST</code></li>
  <li>Accepted content types: <code class="language-plaintext highlighter-rouge">application/json</code></li>
  <li>Encode: <code class="language-plaintext highlighter-rouge">UTF-8</code></li>
</ul>

<h3 id="共通リクエストパラメータ">共通リクエストパラメータ</h3>

<p>下記の項目を持つJSONオブジェクトです。</p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>型</th>
      <th>概要</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>BillingRoboSignaturekey</td>
      <td>string</td>
      <td>ロボで自動生成する <br /> Webhookページで更新可能</td>
    </tr>
    <tr>
      <td>org</td>
      <td>string</td>
      <td>BillingRobo_RobotPayment</td>
    </tr>
    <tr>
      <td>event_name</td>
      <td>string</td>
      <td>ウェブフックイベントの名称 <br /> credit_status_issue</td>
    </tr>
    <tr>
      <td>regist_time</td>
      <td>string</td>
      <td>イベント発生時刻</td>
    </tr>
    <tr>
      <td>notification_time</td>
      <td>string</td>
      <td>イベント通知時刻</td>
    </tr>
    <tr>
      <td>billing_source_id</td>
      <td>int</td>
      <td>請求元ID</td>
    </tr>
    <tr>
      <td><a href="#event_detail-request">event_detail</a></td>
      <td>array</td>
      <td>イベント詳細</td>
    </tr>
  </tbody>
</table>

<h4 id="event_detail-request">event_detail (request)</h4>

<p>共通リクエストパラメータのevent_detailの中身</p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>型</th>
      <th>概要</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>billing_id</td>
      <td>int</td>
      <td>請求先ID <br /> ※<a href="/public/billing_payment_method/credit_card_token.html">クレジットカード登録(トークン方式)</a>ではこちらに値が入りません。</td>
    </tr>
    <tr>
      <td>billing_code</td>
      <td>string</td>
      <td>請求先コード</td>
    </tr>
    <tr>
      <td>payment_number</td>
      <td>int</td>
      <td>決済情報番号 <br /> 決済情報一覧か請求先詳細ページで確認できる</td>
    </tr>
    <tr>
      <td>payment_code</td>
      <td>string</td>
      <td>決済情報コード</td>
    </tr>
    <tr>
      <td>payment_status</td>
      <td>int</td>
      <td>決済情報登録状況 <br /> 0:未登録 1:登録待ち 2:メール送信済 3:申請中 4:登録情報送信エラー 5:登録完了 6:登録失敗</td>
    </tr>
    <tr>
      <td>credit_status</td>
      <td>int</td>
      <td>クレジットカード登録状況 <br /> 0:未処理 1:メール送信済 2:完了 3:エラー</td>
    </tr>
    <tr>
      <td>credit_error_code</td>
      <td>string</td>
      <td>失敗時のエラーコード</td>
    </tr>
    <tr>
      <td>credit_update_time</td>
      <td>string</td>
      <td>credit情報更新時の時刻</td>
    </tr>
  </tbody>
</table>

<h3 id="サンプル">サンプル</h3>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"BillingRoboSignaturekey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$2y$10$RFFenSWN0U8N9Ik1xf0Nj.pQJd/mSasB9ucofm1qTdYeTc8Ag9OLC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"org"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BillingRobo_RobotPayment"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"event_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"credit_status_issue"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"regist_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-28 04:35:15"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"notification_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-28 01:35:40"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"billing_source_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"event_detail"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"billing_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"billing_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"izuxab"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payment_number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payment_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bank123"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"payment_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"credit_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
    </span><span class="nl">"credit_error_code"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"credit_update_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-11-28 01:35:15"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="webhookされるイベント一覧">webhookされるイベント一覧</h2>

<h3 id="請求管理ロボ画面">請求管理ロボ画面</h3>

<table>
  <thead>
    <tr>
      <th>画面名</th>
      <th>URL</th>
      <th>条件</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>請求先登録</td>
      <td>/billing/add</td>
      <td>デフォルト決済手段を「クレジットカード」を選択して登録</td>
    </tr>
    <tr>
      <td>決済情報追加</td>
      <td>/billing_payment_method/add/{請求先ID}</td>
      <td>決済手段を「クレジットカード」にて選択して登録</td>
    </tr>
    <tr>
      <td>請求先承認</td>
      <td>/approve_billing/task</td>
      <td>デフォルト決済手段を「クレジットカード」を選択して登録</td>
    </tr>
    <tr>
      <td>請求先インポート</td>
      <td>/billing/import</td>
      <td>決済手段を「クレジットカード」にて選択して登録</td>
    </tr>
    <tr>
      <td>クレジットカード情報入力ポップアップ<br />（決済連携側）</td>
      <td>https://credit.j-payment.co.jp/gateway/form/type1/ja/payform.aspx</td>
      <td>・請求先登録<br />・決済情報登録<br />・決済情報詳細内→カード情報更新ボタン押下時<br />などに表示されるクレジットカード情報入力ポップアップ→有効性チェックリターン取得時<br /> 「カード情報メール送信」等はステータス変更が行われないので、webhook送信しない</td>
    </tr>
  </tbody>
</table>

<h3 id="請求管理ロボapi">請求管理ロボAPI</h3>

<table>
  <thead>
    <tr>
      <th>API名</th>
      <th>URL</th>
      <th>条件</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>請求先登録更新(複数) v1.0/billing/bulk_upsert</td>
      <td>/api/v1.0/billing/bulk_upsert</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>請求先登録 billing/register</td>
      <td>/api/billing/register</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>請求先登録 billing/add</td>
      <td>/api/billing/add</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>請求先部署登録 billing_individual/add</td>
      <td>/api/billing_individual/add</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>請求先部署編集 billing_individual/edit</td>
      <td>/api/billing_individual/edit</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>請求先登録更新(複数) billing/bulk_upsert</td>
      <td>/api/billing/bulk_upsert</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
    <tr>
      <td>クレジットカード登録(トークン方式)</td>
      <td>/api/v1.0/billing_payment_method/credit_card_token</td>
      <td>決済手段を「クレジットカード」にて決済情報を登録</td>
    </tr>
  </tbody>
</table>

<p>※以下廃止予定のAPIのクレジットカード有効性チェックリターン時のwebhook送信は対象外</p>
<ul>
  <li>請求先登録：api/billing/register</li>
  <li>請求先部署編集：api/billing_individual/edit</li>
  <li>請求先登録更新(複数)：api/bulk_upsert</li>
</ul>

<p><a href="/">TOPへ戻る</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/ROBOTPAYMENT/billing-robo-apispec">billing-robo-apispec</a> is maintained by <a href="https://github.com/ROBOTPAYMENT">ROBOTPAYMENT</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    
  </body>
</html>
