<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>クレジットカード登録(トークン方式) | billing-robo-apispec</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="クレジットカード登録(トークン方式)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="請求管理ロボのAPI仕様書" />
<meta property="og:description" content="請求管理ロボのAPI仕様書" />
<link rel="canonical" href="http://0.0.0.0:4000/public/billing_payment_method/credit_card_token.html" />
<meta property="og:url" content="http://0.0.0.0:4000/public/billing_payment_method/credit_card_token.html" />
<meta property="og:site_name" content="billing-robo-apispec" />
<script type="application/ld+json">
{"headline":"クレジットカード登録(トークン方式)","url":"http://0.0.0.0:4000/public/billing_payment_method/credit_card_token.html","description":"請求管理ロボのAPI仕様書","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="/assets/css/style.css?v=a2c448b5d116447955cb01efe3799a738dc0e23f">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">billing-robo-apispec</h1>
      <h2 class="project-tagline">請求管理ロボのAPI仕様書</h2>
      
        <a href="https://github.com/ROBOTPAYMENT/billing-robo-apispec" class="btn">View on GitHub</a>
      
      
    </section>

    <section class="main-content">
      <h1 id="クレジットカード登録トークン方式">クレジットカード登録(トークン方式)</h1>

<p><code class="language-plaintext highlighter-rouge">/api/v1.0/billing_payment_method/credit_card_token</code></p>

<p>請求先登録更新後、レスポンスで返却された店舗オーダー番号をリクエストに加え、ROBOT PAYMENT決済システムにリクエスト送信する際に、ユーザーが入力するクレジットカード番号を、別の文字列（トークン）に置き換えて通信を行うことで、情報漏洩リスクを軽減しつつ請求先の決済情報のクレジットカード情報を登録することができます。</p>

<p>決済方式には、ポップアップ方式・カスタマイズ方式の2種類があります。
ポップアップ方式とは、JavaScriptでユーザーのブラウザ内に弊社で用意しました決済画面をポップアップで呼び出し、カード情報をトークンに置き換えて加盟店様へ返却しクレジットカード登録を行う方式です。
カスタマイズ方式とは、加盟店様サイト内でカード情報を入力後、JavaScriptで弊社サーバーへ通信しカード情報をトークンに置き換えて、加盟店様へ返却しクレジットカード登録を行う方式です。</p>

<p><strong>トークン決済をご利用される場合、弊社側の設定が必要となりますので、ご希望の際は下記カスタマーサポートまでご連絡をお願い致します。</strong></p>

<p>＜カスタマーサポート＞</p>
<ul>
  <li>TEL：03-4405-0665(平日9:00-18:00)</li>
  <li>Mail：support@billing-robo.jp</li>
</ul>

<p>設定が完了後、コントロールパネルより以下の設定をお願い致します。</p>
<ol>
  <li>「設定」→「決済システム」</li>
  <li>「決済ゲートウェイ＆CTI決済設定」→「決済データ送信元IP」</li>
  <li>「PC用決済フォーム設定」→「決済データ送信元URL」</li>
</ol>

<p>トークンはJavascriptの非同期通信により生成されるため、対応ブラウザは下記の通りになります。</p>
<ul>
  <li>internet Explorer(Microsoftがサポート対象としているバージョンに限る)</li>
  <li>Microsoft Edge 最新版</li>
  <li>Google Chrome 最新版</li>
  <li>Firefox 最新版</li>
  <li>Safari 最新版</li>
</ul>

<h2 id="アウトライン">アウトライン</h2>

<ul>
  <li><a href="#トークンの取得">トークンの取得</a>
    <ul>
      <li><a href="#実装方式サンプル1(ポップアップ方式)">実装方式サンプル1(ポップアップ方式)</a></li>
      <li><a href="#実装方式サンプル2(カスタマイズ方式)">実装方式サンプル2(カスタマイズ方式)</a></li>
    </ul>
  </li>
  <li><a href="#クレジットカード登録">クレジットカード登録</a>
    <ul>
      <li><a href="#リクエスト">リクエスト</a></li>
      <li><a href="#レスポンス">レスポンス</a></li>
      <li><a href="#エラー">エラー</a></li>
    </ul>
  </li>
</ul>

<h2 id="トークンの取得">トークンの取得</h2>

<p><strong>※サイト内でユーザー様が入力したカード情報は必ず消去するように構築お願い致します。</strong></p>

<h3 id="実装方式サンプル1ポップアップ方式">実装方式サンプル1(ポップアップ方式)</h3>

<ol>
  <li>
    <p>決済システムにて提供する JavaScript をインポート</p>

    <pre><code class="language-HTML"> &lt;head&gt;
     &lt;script type="text/javascript"
             src="https://credit.j-payment.co.jp/gateway/js/jquery.js"&gt;&lt;/script&gt;
     &lt;script type="text/javascript"
             src="https://credit.j-payment.co.jp/gateway/js/CPToken.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
</code></pre>
  </li>
  <li>
    <p>受け取ったトークンを格納するフィールドとポップアップ表示用の <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code> タグを設置
 (<code class="language-plaintext highlighter-rouge">CPToken.CardInfo()</code> を呼び出すと自動で <code class="language-plaintext highlighter-rouge">&lt;form id="mainform"&gt;</code> の <code class="language-plaintext highlighter-rouge">&lt;input id="tkn" ..&gt;</code> に値が格納されます)</p>

    <pre><code class="language-HTML"> &lt;form id="mainform"&gt;
     &lt;input id="tkn" name="tkn" type="hidden" value=""&gt;
     &lt;div id="CARD_INPUT_FORM" /&gt;
     &lt;input type="button" value="購入する" onclick="doPurchase()"/&gt;
 &lt;/form&gt;
</code></pre>
  </li>
  <li>
    <p>カード情報入力フォーム表示の JavaScript を実装</p>

    <pre><code class="language-JavaScript"> // カード情報入力フォーム表示
 function doPurchase() {
     //CP非同期通信よりカード番号入力画面を表示する
     CPToken.CardInfo (
         {
             aid: 'xxxxxx'
         },
         execPurchase
     );
 }
</code></pre>
  </li>
  <li>
    <p>受け取ったトークン情報を設定し、フォームの送信処理を行う JavaScript を実装</p>

    <pre><code class="language-JavaScript"> // コールバック関数
 function execPurchase(resultCode, errMsg) {
     if (resultCode != "Success") {
         // 戻り値がSuccess以外の場合はエラーメッセージを表示
         window.alert(errMsg);
     } else {
         // スクリプトからフォームをsubmit
         $("#mainform").submit();
     }
 }
</code></pre>
  </li>
</ol>

<h4 id="ポップアップ方式のトークン生成用関数">ポップアップ方式のトークン生成用関数</h4>

<pre><code class="language-JavaScript">CPToken.CardInfo (
    { 送信するJSONパラメータ },
    コールバック関数
);
</code></pre>

<p>パラメータ</p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>概要</th>
      <th>桁数</th>
      <th>種別</th>
      <th>必須</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>aid</td>
      <td>店舗ID <br /> ※契約時に発行された決済システムの店舗ID</td>
      <td>6</td>
      <td>数値</td>
      <td>必須</td>
    </tr>
  </tbody>
</table>

<h3 id="実装方式サンプル2カスタマイズ方式">実装方式サンプル2(カスタマイズ方式)</h3>

<ol>
  <li>
    <p>決済システムにて提供する JavaScript をインポート</p>

    <pre><code class="language-HTML"> &lt;head&gt;
     &lt;script type="text/javascript"
             src="https://credit.j-payment.co.jp/gateway/js/jquery.js"&gt;&lt;/script&gt;
     &lt;script type="text/javascript"
             src="https://credit.j-payment.co.jp/gateway/js/CPToken.js"&gt;&lt;/script&gt;
 &lt;/head&gt;
</code></pre>
  </li>
  <li>
    <p>受け取ったトークンを格納するフィールドを設置
 (<code class="language-plaintext highlighter-rouge">CPToken.TokenCreate()</code> を呼び出すと自動で <code class="language-plaintext highlighter-rouge">&lt;form id="mainform"&gt;</code> の <code class="language-plaintext highlighter-rouge">&lt;input id="tkn" ..&gt;</code> に値が格納されます)</p>

    <pre><code class="language-HTML">     &lt;form id="mainform"&gt;
         カード番号：
             &lt;input type="text" value="" name="cn" id="cn" /&gt;
         カード有効期限：
             &lt;input type="text" value="" name="ed_year" id="ed_year" /&gt; /
             &lt;input type="text" value="" name="ed_month" id="ed_month" /&gt;
         カード名義人：
             &lt;input type="text" value="" name="fn" id="fn" /&gt;
             &lt;input type="text" value="" name="ln" id="ln" /&gt;
             &lt;input id="tkn" name="tkn" type="hidden" value=""&gt;
         &lt;input type="button" value="購入する" onclick="doPurchase()"/&gt;
     &lt;/form&gt;
</code></pre>
  </li>
  <li>
    <p>トークンを生成するための JavaScript を実装</p>

    <pre><code class="language-JavaScript"> function doPurchase() {
     // CP非同期通信よりトークンを生成する
     CPToken.TokenCreate (
         {
             aid: 'xxxxxx',
             cn: $("#cn").val(),
             ed: $("#ed_year").val() + $("#ed_month").val(),
             fn: $("#fn").val(),
             ln: $("#ln").val()
         },
         execPurchase
     );
 }
</code></pre>
  </li>
  <li>
    <p>受け取ったトークン情報を送信するための JavaScript を実装</p>

    <pre><code class="language-JavaScript"> // コールバック関数
 function execPurchase(resultCode, errMsg) {
     if (resultCode != "Success") {
         window.alert(errMsg);
     } else {
         // カード情報を消去
         $("#cn").val("");
         $("#ed_year").val("");
         $("#ed_month").val("");
         $("#fn").val("");
         $("#ln").val("");
         //スクリプトからフォームをsubmit
         $("#mainform").submit();
     }
 }
</code></pre>
  </li>
</ol>

<h4 id="カスタマイズ方式のトークン生成用関数">カスタマイズ方式のトークン生成用関数</h4>

<pre><code class="language-JavaScript">CPToken.TokenCreate (
    { 送信するJSONパラメータ },
    コールバック関数
);
</code></pre>

<p>パラメータ</p>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>概要</th>
      <th>桁数</th>
      <th>種別</th>
      <th>必須</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>aid</td>
      <td>店舗ID <br /> ※契約時に発行された決済システムの店舗ID</td>
      <td>6</td>
      <td>数値</td>
      <td>必須</td>
    </tr>
    <tr>
      <td>cn</td>
      <td>カード番号</td>
      <td>16</td>
      <td>数値</td>
      <td>必須</td>
    </tr>
    <tr>
      <td>ed</td>
      <td>カード有効期限（YYMM形式）</td>
      <td>4</td>
      <td>数値</td>
      <td>必須</td>
    </tr>
    <tr>
      <td>fn</td>
      <td>カード名義（姓）</td>
      <td>50</td>
      <td>文字列</td>
      <td>必須</td>
    </tr>
    <tr>
      <td>ln</td>
      <td>カード名義（名）</td>
      <td>50</td>
      <td>文字列</td>
      <td>必須</td>
    </tr>
    <tr>
      <td>cvv</td>
      <td>セキュリティコード</td>
      <td>3または4</td>
      <td>数値</td>
      <td>(セキュリティコード利用オプションをご利用時)</td>
    </tr>
    <tr>
      <td>md</td>
      <td>支払い方法 <br /> 「10」一括払い</td>
      <td>2</td>
      <td>定型</td>
      <td>必須</td>
    </tr>
  </tbody>
</table>

<h2 id="クレジットカード登録">クレジットカード登録</h2>

<h3 id="リクエスト">リクエスト</h3>

<ul>
  <li>Method URL: <code class="language-plaintext highlighter-rouge">https://billing-robo.jp:10443/api/v1.0/billing_payment_method/credit_card_token</code></li>
  <li>Preferred HTTP method: <code class="language-plaintext highlighter-rouge">POST</code></li>
  <li>Accepted content types: <code class="language-plaintext highlighter-rouge">application/json</code></li>
  <li>Encode: <code class="language-plaintext highlighter-rouge">UTF-8</code></li>
</ul>

<h4 id="parameters">Parameters</h4>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>概要</th>
      <th>桁数</th>
      <th>種別</th>
      <th>必須</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>user_id</td>
      <td>ユーザID（管理画面へのログインID）</td>
      <td>100</td>
      <td><a href="/#種別">メール形式</a></td>
      <td>必須</td>
    </tr>
    <tr>
      <td>access_key</td>
      <td>アクセスキー</td>
      <td>100</td>
      <td><a href="/#種別">半角英数</a></td>
      <td>必須</td>
    </tr>
    <tr>
      <td>billing_code</td>
      <td>請求先コード</td>
      <td>20</td>
      <td><a href="/#種別">半角英数 + 記号</a></td>
      <td>必須</td>
    </tr>
    <tr>
      <td>billing_payment_method_number</td>
      <td>決済情報番号</td>
      <td>18</td>
      <td>数値</td>
      <td>(必須)^1</td>
    </tr>
    <tr>
      <td>billing_payment_method_code</td>
      <td>決済情報コード</td>
      <td>20</td>
      <td><a href="/#種別">半角英数 + 記号</a></td>
      <td>(必須)^1</td>
    </tr>
    <tr>
      <td>token</td>
      <td>トークン情報</td>
      <td> </td>
      <td><a href="/#種別">半角英数 </a></td>
      <td>必須</td>
    </tr>
  </tbody>
</table>

<h3 id="レスポンス">レスポンス</h3>

<ul>
  <li>Type: <code class="language-plaintext highlighter-rouge">application/json</code></li>
  <li>Encode: <code class="language-plaintext highlighter-rouge">UTF-8</code></li>
</ul>

<h4 id="fields">Fields</h4>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>概要</th>
      <th>型</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="#error-response">error</a></td>
      <td>エラー <br /> ※正常時はnull</td>
      <td><code class="language-plaintext highlighter-rouge">object</code></td>
    </tr>
  </tbody>
</table>

<h5 id="error-response">error (response)</h5>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>概要</th>
      <th>型</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>code</td>
      <td>エラーコード</td>
      <td>string</td>
    </tr>
    <tr>
      <td>message</td>
      <td>エラーメッセージ</td>
      <td>string</td>
    </tr>
  </tbody>
</table>

<h3 id="使用例">使用例</h3>

<h4 id="リクエスト例">リクエスト例</h4>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sample@robotpayment.co.jp"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"access_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxxxxxxxxxxxx"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"billing_code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"billing_code"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"billing_payment_method_number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"token"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="レスポンス例">レスポンス例</h4>

<p>Status: 200 OK</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"error"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"code"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ER000"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"message"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Credit card payment error."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="エラー">エラー</h3>

<p><a href="/#共通エラー">共通エラー</a></p>

<p><a href="/payment_ec.html">決済システムエラーコード</a></p>

<p>個別エラー</p>

<table>
  <thead>
    <tr>
      <th>エラーコード</th>
      <th>内容</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3401</td>
      <td>請求先コードが不正</td>
    </tr>
    <tr>
      <td>3402</td>
      <td>決済情報番号が不正</td>
    </tr>
    <tr>
      <td>3403</td>
      <td>決済情報コードが不正</td>
    </tr>
    <tr>
      <td>3404</td>
      <td>請求先決済番号と請求先決済コードは同時に指定できない</td>
    </tr>
    <tr>
      <td>3405</td>
      <td>トークン情報が不正</td>
    </tr>
  </tbody>
</table>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/ROBOTPAYMENT/billing-robo-apispec">billing-robo-apispec</a> is maintained by <a href="https://github.com/ROBOTPAYMENT">ROBOTPAYMENT</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    
  </body>
</html>
