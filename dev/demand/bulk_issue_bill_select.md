# 請求書発行

`/api/v1.0/demand/bulk_issue_bill_select`

請求書発行をAPIで行う場合に利用します。
リクエスト上限は100件です。

## リクエスト
- Method URL: `https://billing-robo.jp:10443/api/v1.0/demand/bulk_issue_bill_select`
- Preferred HTTP method: `POST`
- Accepted content types: `application/json`
- Encode: `UTF-8`

### Parameters

| 名前                      | 概要                                 | 桁数 | 種別                               | 必須 |
| ------------------------- | ------------------------------------ | ---- | ---------------------------------- | ---- |
| user_id                   | ユーザーID（管理画面へのログインID） | 100  | [半角英数\*1](/README.md#種別注釈) | 必須 |
| access_key                | アクセスキー                         | 100  | [半角英数\*3](/README.md#種別注釈) | 必須 |
| [demand](#demand-request) | 請求情報に属するパラメータ           |      | `Array(demand)`                    |      |

#### demand (request)

<!-- 要素が多くないものは detail, summaryタグを使わない (なくても見やすくため) -->
下記のような項目のオブジェクトを持つリスト

| 名前   | 概要           | 桁数 | 種別   | 必須     |
| ------ | -------------- | ---- | ------ | -------- |
| number | 請求情報番号   | 100  | 文字列 | (必須)^1 |
| code   | 請求情報コード | 100  | 文字列 | (必須)^1 |


## レスポンス

- Type: `application/json`
- Encode: `UTF-8`

### Fields

| 名前                       | 概要                       | 型              |
| -------------------------- | -------------------------- | --------------- |
| user_id                    | ユーザーID                 | string          |
| access_key                 | アクセスキー               | string          |
| [demand](#demand-response) | 請求情報に属するパラメータ | `Array(demand)` |

#### demand (response)

<!-- 要素が多くないものは detail, summaryタグを使わない (なくても見やすくため) -->
下記のような項目のオブジェクトを持つリスト

| 名前              | 概要                                | 型     |
| ----------------- | ----------------------------------- | ------ |
| error_code        | エラーコード <br> ※正常時はnull     | string |
| error_message     | エラーメッセージ <br> ※正常時はnull | string |
| number            | 請求情報番号                        | int    |
| code              | 請求情報コード                      | string |
| demand.sales.bill | 請求書に属するパラメータ            |        |
| number            | 請求書番号                          | string |
| issue_date        | 請求書発行日                        | date   |


## 使用例

### リクエスト

```
{
    "user_id": "sample@robotpayment.co.jp",
    "access_key": "xxxxxxxxxxxxxxxx",
    "demand": [
        {
            "number": "1",
            "code": "1001"
        }
    ]
}
```

### レスポンス

Status: 200 OK

```
{
    "user_id": "sample@robotpayment.co.jp",
    "access_key": "xxxxxxxxxxxxxxxx",
    "demand": [
        {
            "error_code": null,
            "error_message": null,
            "number": "1",
            "code": "1001",
            "sales": [
                {
                    "bill": [
                        {
                            "number": "201805-1001-1",
                            "issue_date": "2018/05/01"
                        }
                    ]
                }
            ]
        }
    ]
}
```

## エラー

| エラーコード | 内容                                                                                     |
| ------------ | ---------------------------------------------------------------------------------------- |
| 3301         | 設定された作成日以前の請求情報が選択されています                                         |
| 3302         | 請求書か売上が既に発行されている請求情報が選択されています                               |
| 3303         | 承認中の請求情報が選択されています                                                       |
| 3304         | 請求先部署が停止されている請求情報が選択されています                                     |
| 3305         | 請求先が停止されている請求情報が選択されています                                         |
| 3306         | 請求情報が停止されている請求情報が選択されています                                       |
| 3307         | 数量が0の請求情報が選択されています                                                      |
| 3308         | 合計請求書の請求先部署が停止もしくは削除されている請求情報が選択されています             |
| 3309         | 合計請求書の請求先部署の決済手段が停止もしくは削除されている請求情報が選択されています   |
| 3310         | 条件に一致するデータが存在しません                                                       |
| 3311         | 売上が作成されましたが、請求書発行に失敗しました。※全件処理は中断しません                |
| 3312         | 請求情報が定期従量で数量が0のため、請求書発行をスキップしました。※全件処理は中断しません |
| 3313         | 他の請求書が発行に失敗したので、発行しませんでした                                       |
| 3314         | 内部的なエラーにより売上が作成されず請求書発行に失敗しました                             |
| 3315         | 請求情報番号が不正                                                                       |
| 3316         | 請求情報コードが不正                                                                     |
